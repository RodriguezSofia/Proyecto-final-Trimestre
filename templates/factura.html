<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Factura • Heladería Annia</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/factura.css') }}">
</head>

<body>

<div class="invoice-wrap" role="document">
  <header class="invoice-header">
    <div class="brand">
      <div class="logo">AN</div>
      <div>
        <h1>Heladería Annia</h1>
        <p class="muted">Dulces momentos • Sabores artesanales</p>
      </div>
    </div>

    <div class="hdr-right">
      <div class="invoice-title">FACTURA / TICKET</div>
      <div class="small monos">Nº: <strong id="numFactura"></strong></div>
      <div class="small muted">Fecha: <strong id="fechaFactura"></strong></div>
    </div>
  </header>

  <main class="invoice-body">
    <div class="meta">
      <div>
        <h4>Heladería</h4>
        <p>Avenida Principal 123<br/>Ciudad • NIT 900123456-7</p>
      </div>
      <div>
        <h4>Cliente</h4>
        <p id="nombreCliente">Invitado<br/>C.C. —</p>
      </div>
      <div>
        <h4>Vendedor</h4>
        <p>Andrea / Caja 2</p>
      </div>
    </div>

    <section class="items">
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Descripción</th>
            <th class="qty">Cant.</th>
            <th class="price">Precio</th>
            <th class="total">Total</th>
          </tr>
        </thead>

        <tbody id="facturaItems"></tbody>

      </table>
    </section>

    <div class="summary">
      <div class="row">
        <span class="muted">Subtotal</span>
        <span class="monos" id="subtotalFactura"></span>
      </div>

      <div class="row">
        <span class="muted">Descuento</span>
        <span class="monos">$0</span>
      </div>

      <div class="row">
        <span class="muted">IVA (0%)</span>
        <span class="monos">$0</span>
      </div>

      <div class="row total">
        <span>Total a pagar</span>
        <span class="monos" id="totalFactura"></span>
      </div>
    </div>
  </main>

  <footer class="invoice-footer">
    <div class="payment-methods">
      <div class="chip">Efectivo</div>
      <div class="chip">Tarjeta</div>
      <div class="chip">QR • PSE</div>
    </div>

    <div class="notes">
      <div class="muted">Observaciones:</div>
      <p>Gracias por preferir Heladería Annia. Conservar en congelador si aplica.</p>
    </div>
  </footer>
</div>

<script>
// ────────── OBTENER DATOS DEL LOCALSTORAGE ──────────
const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
const total = parseFloat(localStorage.getItem("total")) || 0;
const usuario = localStorage.getItem("usuario") || "Invitado";

// ────────── LLENAR DATOS DE CABECERA ──────────
document.getElementById("nombreCliente").innerHTML = usuario;
document.getElementById("numFactura").innerHTML = Math.floor(Math.random()*90000 + 10000);
document.getElementById("fechaFactura").innerHTML = new Date().toISOString().split("T")[0];

// ────────── LLENAR PRODUCTOS DE LA FACTURA ──────────
const tbody = document.getElementById("facturaItems");

if (carrito.length === 0) {
    tbody.innerHTML = `
        <tr>
            <td colspan="5" class="muted" style="text-align:center;">No hay productos en la factura</td>
        </tr>`;
} else {
    tbody.innerHTML = carrito.map(prod => `
        <tr>
            <td><strong>${prod.nombre}</strong></td>
            <td class="muted">Producto comprado</td>
            <td class="qty">1</td>
            <td class="price monos">$${prod.precio}</td>
            <td class="total monos">$${prod.precio}</td>
        </tr>
    `).join("");
}

// ────────── TOTALES ──────────
document.getElementById("subtotalFactura").textContent = "$" + total;
document.getElementById("totalFactura").textContent = "$" + total;
</script>

</body>
</html>
