<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenÃº | HeladerÃ­a Annia</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/menu.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/logo_01.jpeg') }}" type="image/x-icon">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body>
    <!-- NAV SUPERIOR -->
    <nav class="barra-navegacion d-flex justify-content-between align-items-center px-4 py-2">
        <a href="{{ url_for('home') }}" class="logo-link">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo HeladerÃ­a Annia" class="logo">
        </a>

        <!-- *** MENÃš DEPENDIENDO DE LA SESIÃ“N *** -->
        <div class="d-flex align-items-center gap-3">

            {% if not session.get('usuario_nombre') %}
                <!-- SI NO HAY SESIÃ“N -->
                <a href="{{ url_for('registro') }}" class="btn" style="background-color:#F54388;color:white;">Registrarse</a>
                <a href="{{ url_for('login') }}" class="btn" style="background-color:#147D7D;color:white;">Iniciar sesiÃ³n</a>

            {% else %}
                <!-- SI HAY SESIÃ“N -->
                <span style="font-weight:bold; color:#147D7D; font-size:1.1em;">
                    Hola, {{ session['usuario_nombre'] }}
                </span>
                <a href="{{ url_for('logout') }}" class="btn btn-danger">Cerrar sesiÃ³n</a>
            {% endif %}

            <!-- ğŸ”¥ CONTADOR -->
            <span id="carritoCount" style="
                background:#F54388;
                color:white;
                padding:3px 8px;
                border-radius:12px;
                font-weight:bold;
            ">0</span>

        </div>
    </nav>

    <!-- SEGUNDA BARRA DE MENÃš -->
    <header class="py-2 shadow-sm" style="background:#ffe6f7;">
        <nav class="container">
            <ul class="d-flex justify-content-center gap-4 list-unstyled m-0">
                <li><a href="{{ url_for('home') }}">Inicio</a></li>
                <li><a href="{{ url_for('menu') }}">MenÃº</a></li>
                <li><a href="{{ url_for('acerca') }}">Acerca de</a></li>
                <li><a href="{{ url_for('contacto') }}">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <main style="background-color: #FFFDF2; padding: 40px 20px;">
        <section id="Menu" class="container text-center">
            <h2 style="color: #F54388; font-size: 2.5em; margin-bottom: 10px;">Nuestro MenÃº</h2>
            <p style="color: #147D7D; font-style: italic; font-size: 1.1em; margin-bottom: 40px;">Disfruta nuestras delicias frÃ­as: helados, copas, malteadas y mÃ¡s. Â¡Hechos con amor y sabor artesanal!</p>

            <div class="menu-grid">
                <article>
                    <h3>Cono ClÃ¡sico</h3>
                    <p>1 bola de tu sabor favorito en un crujiente cono.</p>
                    <span class="precio">$4.000</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Cono ClÃ¡sico', 4000)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

                <article>
                    <h3>Cono Doble</h3>
                    <p>Dos bolas de sabor combinadas con cobertura de chocolate.</p>
                    <span class="precio">$6.000</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Cono Doble', 6000)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

                <article>
                    <h3>Copa Tropical</h3>
                    <p>Helado con frutas frescas y salsa de mango.</p>
                    <span class="precio">$8.500</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Copa Tropical', 8500)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

                <article>
                    <h3>Banana Split</h3>
                    <p>Banano, tres bolas de helado, crema batida y cereza.</p>
                    <span class="precio">$9.000</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Banana Split', 9000)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

                <article>
                    <h3>Malteada de Fresa</h3>
                    <p>Batido cremoso con helado natural de fresa.</p>
                    <span class="precio">$7.000</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Malteada Fresa', 7000)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

                <article>
                    <h3>Malteada Oreo</h3>
                    <p>Helado de vainilla con galletas Oreo trituradas.</p>
                    <span class="precio">$7.500</span>
                    <button class="btn-agregar" onclick="agregarAlCarrito('Malteada Oreo', 7500)">
                        <i class="bi bi-basket2-fill"></i> Agregar
                    </button>
                </article>

            </div>
        </section>
    </main>

    <!-- CARRITO FLOTANTE -->
    <a href="#" id="carritoFlotante" data-bs-toggle="modal" data-bs-target="#modalCarrito" style="background-color: #147D7D;">
        <i class="bi bi-basket2-fill"></i>
        <span id="carritoCountFloat" style="background-color: #F54388;">0</span>
    </a>

    <!-- MODAL DEL CARRITO -->
    <div class="modal fade" id="modalCarrito" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header" style="background-color: #FCEA85; color: #147D7D;">
                    <h5 class="modal-title">Mi Carrito</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body" id="listaCarrito">
                    <p>Tu carrito estÃ¡ vacÃ­o ğŸ¦</p>
                </div>

                <!-- âœ” BOTÃ“N CORREGIDO -->
                <div class="modal-footer">
                    <button class="btn" style="background-color: #F54388; color: white;" onclick="validarCompra()">
                        Comprar
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- MODAL LOGIN -->
    <div class="modal fade" id="modalLogin" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #B5EFCC; color: #147D7D;">
                    <h5 class="modal-title">Debes iniciar sesiÃ³n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Para poder comprar debes iniciar sesiÃ³n en tu cuenta.
                </div>
                <div class="modal-footer">
                    <a href="{{ url_for('login') }}" class="btn" style="background-color: #147D7D; color: white;">Iniciar SesiÃ³n</a>
                </div>
            </div>
        </div>
    </div>

    <footer style="background-color: #FCEA85; color: #147D7D;">
        <p>&copy; 2025 HeladerÃ­a Annia. Todos los derechos reservados.</p>
    </footer>

    <!-- âœ” VARIABLE DE SESIÃ“N CORREGIDA -->
<script>
const usuarioLogueado = "{{ 'true' if session.get('usuario_nombre') else 'false' }}" === "true";
let carrito = [];

const carritoCount = document.getElementById("carritoCount");
const carritoCountFloat = document.getElementById("carritoCountFloat");
const listaCarrito = document.getElementById("listaCarrito");

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AGREGAR PRODUCTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function agregarAlCarrito(nombre, precio) {
    carrito.push({ nombre, precio });
    actualizarContadores();
    renderCarrito();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ELIMINAR PRODUCTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function eliminarProducto(index) {
    carrito.splice(index, 1);
    actualizarContadores();
    renderCarrito();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTADORES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function actualizarContadores() {
    carritoCount.textContent = carrito.length;
    carritoCountFloat.textContent = carrito.length;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RENDER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCarrito() {
    if (carrito.length === 0) {
        listaCarrito.innerHTML = "<p>Tu carrito estÃ¡ vacÃ­o ğŸ¦</p>";
        return;
    }

    listaCarrito.innerHTML = carrito.map((item, index) => `
        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
            <span>${item.nombre} â€” $${item.precio}</span>
            <button class="btn btn-danger btn-sm" onclick="eliminarProducto(${index})">
                <i class="bi bi-trash3-fill"></i>
            </button>
        </div>
    `).join("");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VALIDAR SI ESTÃ LOGUEADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function validarCompra() {
    if (!usuarioLogueado) {
        const loginModal = new bootstrap.Modal(document.getElementById("modalLogin"));
        loginModal.show();
        return;
    }

    comprar();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ COMPRAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function comprar() {

    if (carrito.length === 0) {
        alert("Tu carrito estÃ¡ vacÃ­o");
        return;
    }

    // Calcular total
    const total = carrito.reduce((suma, p) => suma + p.precio, 0);

    // Guardar en localStorage para factura.html
    localStorage.setItem("carrito", JSON.stringify(carrito));
    localStorage.setItem("total", total);
    localStorage.setItem("usuario", "{{ session.get('usuario_nombre') }}");

    alert("Compra realizada correctamente");

    // Redirigir a factura
    window.location.href = "/factura";
}
</script>


</body>
</html>
