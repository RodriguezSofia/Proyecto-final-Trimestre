<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedidos</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/pedidos.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
</head>
<body>
<h1>Pedidos</h1>

<div class="tabla-contenedor">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha</th>
                <th>Total</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for p in pedidos %}
            <tr class="pedido-row">
                <td>#{{ p.Id_factura }}</td>
                <td>{{ p.Nombre_destinatario }}</td>
                <td>{{ p.Fecha.strftime('%Y-%m-%d') }}</td>
                <td>${{ "{:,.0f}".format(p.total) }}</td>
                <td>
                    <form method="POST" style="margin:0;">
                        <input type="hidden" name="id_factura" value="{{ p.Id_factura }}">
                        <button type="submit" class="button-volver">Ver detalle</button>
                    </form>
                </td>
            </tr>
            {% if detalle_pedido and detalle_pedido[0].Id_factura == p.Id_factura %}
            <tr class="detalle-row">
                <td colspan="5">
                    <table class="detalle-tabla">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Sabor</th>
                                <th>Precio</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for d in detalle_pedido %}
                            <tr>
                                <td>{{ d.Nombre_producto }}</td>
                                <td>{{ d.Nombre_sabor }}</td>
                                <td>${{ "{:,.0f}".format(d.Total) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endif %}
            {% else %}
            <tr>
                <td colspan="5">No hay pedidos registrados</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Botón volver al panel -->
    {% if session['usuario_tipo'] == 1 %}
        <a href="{{ url_for('admin_panel') }}" class="button-volver">← Volver al Panel</a>
    {% elif session['usuario_tipo'] == 2 %}
        <a href="{{ url_for('panel_trabajadores') }}" class="button-volver">← Volver al Panel</a>
    {% endif %}
</div>
</body>
</html>
